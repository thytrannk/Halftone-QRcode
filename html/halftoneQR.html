
<P>
<DIV ALIGN="CENTER">
<TITLE>CMPUT 511 Project</TITLE>
<B><H1>CMPUT 511 Project</H1></B>
<B><H1>Halftone QR Codes</H1></B>
<EM>Katie Tran</EM><BR>
<EM>University of Alberta</EM><BR>
<EM>katie.tran@ualberta.ca</EM><BR>

</DIV>

<P>
QR code was invented in Japan to replace bar code because it has the capacity to encode more information. The code was first used by the automobile industry to manage the production line as well as issue transaction slips. Nowadays, QR code is used widely around the world by companies to encode URLs to their websites so that customers do not have to type in but only need to scan the code using their smart phones. The code can also be seen on product packaging to encode information about that product.

<P>
As the QR code takes up space on the product packaging or advertisement, companies would want to have ways to improve the aesthetics of the code, such as embedding the company logo or product image into the code. There have been previous attempts at doing this; however, the methods are mostly tedious and require trial-and-error, and the results are only mediocre.

<P>
Chu et al. [2013] proposed an algorithm to embed halftone images into QR codes that gives high-quality results. The principle is to divide each module of the QR code into submodules and minimally bind these to the original module while adapting to the object halftone image. The authors also evaluated the reliability of each possible pattern made by the submodules, and tried to balance the reliability of the code and how closely it represents the halftone image by solving an optimization problem. Figure 1 shows the results generated by this algorithm compared to some previous methods.

<P>

<DIV ALIGN="CENTER"><A NAME="comparison"><tex2html_anchor_mark></A><A NAME="50"><tex2html_anchor_mark></A>
<TABLE>
<CAPTION ALIGN="BOTTOM"><STRONG>Figure 1:</STRONG>
QR codes generated by: (a) Unitag ([Laporte]); (b) QArt ([Cox, 2012]); (c) Visualead; (d) Chu et al. [2013] (the paper that is implemented in this project) (Images taken from Chu et al. [2013])</CAPTION>
<TR><TD><DIV ALIGN="CENTER">
<IMG
  WIDTH="896" HEIGHT="240" ALIGN="BOTTOM" BORDER="0"
 SRC="./comparison.png"
 ALT="Image comparison">

</DIV></TD></TR>
</TABLE>
</DIV>


<P>
In ideal situations, as long as the center submodules have the same color as the original modules, a decoder would be able to decode the QR code. In reality, the readability of the QR code can be affected by many factors, such as lighting condition, poor focus, etc. This is why the algorithm proposed by Chu et al. [2013] has to consider the reliability score and balancing reliability and regularization energy. However, in order to evaluate pattern reliability, a large database of QR codes is required, and the codes have to be modified to reflect real-life scanning condition. This is beyond the scope of this project. Therefore, for this project, I implemented a simplified version of this algorithm, which produces halftone QR codes but does not optimize the reliability or enhance features.

<P>

<H1><A NAME="SECTION00010000000000000000">
How the program works</A>
</H1>

<P>
The program that was implemented takes as input an image (.jpg, .png, or .bmp). The image can be either colored or greyscale, but the program will automatically convert it to greyscale. The user has an option of rescaling the image so that it fits the QR code better. If the image is larger than the QR code, only the center part of the image would be embedded. If the image is smaller than the QR code, the image will appear at the center of the QR code. The default QR code version is set to version 6, which means the resulting halftone QR code would have a size of 123 &times; 123 pixels. The user then chooses the halftone algorithm to use, either Floyd-Steinberg error diffusion or dot diffusion algorithm. After that, the information that will be encoded in the QR code is input. If the amount of data exceeds the capacity of QR version 6, the minimum version that is required would automatically be used. The program then outputs the halftone QR code.

<P> Below is an example of how the program is run to generate a QR code encoding the text "This is a picture of Donald Duck.", embedding a rescaled version of the image file <em>donald_duck.jpg</em> in the output halftone QR code.

<xmp>
Object image file name: donald_duck.jpg
X = 350; Y = 262; bpp = 32; nChannel = 4
The QR code has size 123x123 pixels. Do you want to rescale the image to better fit the QR code? (y/n) y
New width: 175
New height: 131
X = 175; Y = 131; bpp = 32; nChannel = 4
Which halftoning algorithm do you want to use? (1: Floyd-Steinberg; 2: dot diffusion) 2
What do you want to encode in the QR code? This is a picture of Donald Duck.
Output filename (without extension): outputQR
Decoded information from halftone QR: This is a picture of Donald Duck.
</xmp>

<P>

<H1><A NAME="SECTION00020000000000000000">
Results</A>
</H1>

<P>
Figure 2 shows some halftone QR codes that were generated using my implementation of the algorithm from Chu et al. [2013]. All of these QR codes could be decoded using both <TT>ZXing</TT> library (using <EM>.png</EM> images as input) and a QR code reader application on Android (scanned under normal room lighting). I have also tried generating other QR codes, and most could be decoded using both these methods.

<P>

<DIV ALIGN="CENTER"><A NAME="QRs"><tex2html_anchor_mark></A><A NAME="51"><tex2html_anchor_mark></A>
<TABLE>
<CAPTION ALIGN="BOTTOM"><STRONG>Figure 2:</STRONG>
Halftone QR codes generated using the algorithm from Chu et al. [2013]</CAPTION>
<TR><TD><DIV ALIGN="CENTER">
<IMG
  WIDTH="893" HEIGHT="213" ALIGN="BOTTOM" BORDER="0"
 SRC="./results.png"
 ALT="Image results">

</DIV></TD></TR>
</TABLE>
</DIV>


<P>

<H1><A NAME="SECTION00030000000000000000">
Code</A>
</H1>

<P>
Download source code <A href="halftoneQR.zip" download>here</A>. (tested on MacOS X and Linux)

<P>
Requirements:

<UL>
<LI><A HREF=http://freeimage.sourceforge.net>FreeImage</A></LI>
<LI><A HREF=https://github.com/fukuchi/libqrencode>Libqrencode</A></LI>
<LI><A HREF=https://github.com/zxing/zxing>ZXing</A></LI>
</UL>

<P>

<H2><A NAME="SECTIONREF">References</A>
</H2>

<UL>
<LI>H.-K. Chu, C.-S. Chang, R.-R. Lee, and N. J. Mitra. Halftone qr codes. ACM Trans. Graph., 32(6):217:1&minus;217:8, Nov. 2013. ISSN 0730&minus;0301. doi: 10.1145/2508363.2508408. URL <A HREF=http://doi.acm.org/10.1145/2508363.2508408>http://doi.acm.org/10.1145/2508363.2508408.</A></LI>
<LI>R. Cox. Qart codes, Apr. 2012. URL <A HREF=https://research.swtch.com/qart>https://research.swtch.com/qart.</A></LI>
<LI>Denso Wave Incorporated. Qrcode.com. URL <A HREF=http://www.qrcode.com/en>http://www.qrcode.com/en/.</A></LI>
<LI>K. Fukuchi. libqrencode, 2006. URL <A HREF=https://fukuchi.org/works/qrencode>https://fukuchi.org/works/qrencode/.</A></LI>
<LI>A. Laporte. UnitagQR. URL <A HREF=https://www.unitag.io/qrcode>https://www.unitag.io/qrcode.</A></LI>
<LI>S. Owen, D. Switkin, and Z. Team. Zxing, 2008. URL <A HREF=https://github.com/zxing/zxing>https://github.com/zxing/zxing.</A></LI>
<LI>Sustainable App Developer. Qr code reader, 2018. URL <A HREF=https://play.google.com/store/apps/details?id=com.qrcodereaderapp>https://play.google.com/store/apps/details?id=com.qrcodereaderapp.</A></LI>
<LI>Visualead. Visualead. URL <A HREF=https://www.visualead.com>https://www.visualead.com.</A></LI>
</UL>

<B>